@using ECommerceWeb.Enums
@model ECommerceWeb.DTOs.OrderProductDTO

@{
    ViewBag.Title = "Order Details";
    var user = Session["User"] as ECommerceWeb.Entities.User;
}

<h2>Order Details</h2>
<h4>Order ID: @Model.Id</h4>

@{
    // Get status from StatusId
    OrderStatus status = (OrderStatus)Model.StatusId;
}

<p>
    Status: <strong>@status.ToString()</strong>
    @if (status == OrderStatus.PendingApproval)
    {
        <span class="badge bg-warning">Pending Approval</span>
    }
    else if (status == OrderStatus.Approved)
    {
        <span class="badge bg-success">Approved</span>
    }
    else if (status == OrderStatus.Processing)
    {
        <span class="badge bg-info">Processing</span>
    }
    else if (status == OrderStatus.CancelledByUser || status == OrderStatus.CancelledByAdmin)
    {
        <span class="badge bg-danger">Cancelled</span>
    }
    else if (status == OrderStatus.OnTheWay)
    {
        <span class="badge bg-secondary">On The Way</span>
    }
    else if (status == OrderStatus.Delivered)
    {
        <span class="badge bg-primary">Delivered</span>
    }
</p>

@* Admin actions if user is admin and order is pending *@
@if (user != null && user.Type == "Admin" && status == OrderStatus.PendingApproval)
{
    <div class="mb-3">
        <a href="/Admin/ApproveOrder/@Model.Id" class="btn btn-success">Approve</a>
        <a href="/Admin/CancelOrder/@Model.Id" class="btn btn-danger">Cancel</a>
    </div>
}

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Product</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.OrderDetails)
        {
            <tr>
                <td>@item.Product.Name</td>
                <td>@item.Qty</td>
                <td>@item.Price.ToString("0.00")</td>
                <td>@((item.Qty * item.Price).@ToString("0.00"))</td>
            </tr>
        }
        <tr>
            <th colspan="3" class="text-right">Grand Total</th>
            <th>@Model.Total.ToString("0.00")</th>
        </tr>
    </tbody>
</table>
